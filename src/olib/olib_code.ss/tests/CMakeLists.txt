cmake_minimum_required(VERSION 2.8)

project(OlibTester CXX)

enable_testing()

INCLUDE_DIRECTORIES(.)

INCLUDE($ENV{SAFIR_SDK}/data/build/cmake_settings.txt)

if (UNIX)
    FIND_PACKAGE(IODBC)
    if (IODBC_FOUND)
      INCLUDE_DIRECTORIES(${IODBC_INCLUDE_DIRS})
      SET(ODBC_LIBRARIES ${IODBC_LIBRARIES})
      ADD_DEFINITIONS(-DODBC_IS_IODBC)
    else()
      message("iODBC not found, trying UnixODBC")
      FIND_PACKAGE(UnixODBC REQUIRED)
      INCLUDE_DIRECTORIES(${UnixODBC_INCLUDE_DIRS})
      SET(ODBC_LIBRARIES ${UnixODBC_LIBRARIES})
      ADD_DEFINITIONS(-DODBC_IS_UNIXODBC)
    endif()
endif()

FILE(GLOB_RECURSE headers *.h)
FILE(GLOB sources *.cpp)
add_executable(OlibTester ${sources} ${headers})

if (NOT MSVC)
    TARGET_LINK_LIBRARIES(OlibTester olib swre_interface_cpp dots_generated-Safir-cpp dots_cpp ${ODBC_LIBRARIES} )
endif()
set(CTEST_OUTPUT_ON_FAILURE ON)
ADD_TEST(OlibTest_Connect OlibTester -connect)
ADD_TEST(OlibTest_Disconnect OlibTester -disconnect)
ADD_TEST(OlibTest_AllocCloseStatement OlibTester -allocclosestm)
ADD_TEST(OlibTest_ConnectionPooling   OlibTester -connectionpooling)
ADD_TEST(OlibTest_ConnectionTimeout   OlibTester -connectiontimeout)
ADD_TEST(OlibTest_QueryTimeout   OlibTester -readalltimeout)
ADD_TEST(OlibTest_ClearTable OlibTester -cleartable)
ADD_TEST(OlibTest_CreateData OlibTester -createdata)
ADD_TEST(OlibTest_ReadData   OlibTester -readdata)
ADD_TEST(OlibTest_UpdateData   OlibTester -updatedata)
ADD_TEST(OlibTest_InsertInto42   OlibTester -insertinto42)
ADD_TEST(OlibTest_DeleteData   OlibTester -deletedata)
ADD_TEST(OlibTest_BinaryWriteRead   OlibTester -binaryrw)
ADD_TEST(OlibTest_BlobWriteRead   OlibTester -blobrw)
ADD_TEST(OlibTest_NClobWriteRead   OlibTester -nclobrw)
ADD_TEST(OlibTest_LotsOfInput   OlibTester -lotsofinput)
ADD_TEST(OlibTest_OutParam   OlibTester -outparam)
ADD_TEST(OlibTest_InOutParam   OlibTester -inoutparam)
ADD_TEST(OlibTest_PerformanceTest   OlibTester -perftest)
