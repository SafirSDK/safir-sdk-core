<?xml version="1.0" encoding="utf-8"?>
<object xmlns="urn:safir-dots-unit">
  <name>DoseTest.Items.TestCase</name>
  <members>
    <member>
      <name>Description</name>
      <!-- The test assumes that lower instance ids are injected before higher which isn't a guaranteed behaviour of the Dob -->
      <value>Test that SetAll on an instance for which there is a ghost, performed before OnInitialInjectionDone, gives a GhostExistsException</value>
    </member>
    <member>
      <name>Expectation</name>
      <value>P0 gets a GhostExistsException</value>
    </member>
    <member>
      <name>TestCaseSetupActions</name>
      <arrayElements>

        <!-- Let partner 1 create 2 ghosts -->
        <arrayElement>
          <object>
            <name>DoseTest.Action</name>
            <members>
              <member>
                <name>Partner</name>
                <value>1</value>
              </member>
              <member>
                <name>ActionKind</name>
                <value>DoseTest.ActionEnum.RegisterEntityHandlerInjection</value>
              </member>
              <member>
                <name>TypeId</name>
                <value>DoseTest.InjectableEntity</value>
              </member>
              <member>
                <name>Handler</name>
                <value>DEFAULT_HANDLER</value>
              </member>
              <member>
                <name>InstanceIdPolicy</name>
                <value>Safir.Dob.InstanceIdPolicy.RequestorDecidesInstanceId</value>
              </member>
              <member>
                <name>Consumer</name>
                <value>0</value>
              </member>
            </members>
          </object>
        </arrayElement>
      </arrayElements>
    </member>
    <member>
      <name>TestActions</name>
      <arrayElements>
        <arrayElement>
          <object>
            <name>DoseTest.Action</name>
            <members>
              <member>
                <name>Partner</name>
                <value>1</value>
              </member>
              <member>
                <name>ActionKind</name>
                <value>DoseTest.ActionEnum.SetAll</value>
              </member>
              <member>
                <name>Instance</name>
                <value>111</value>
              </member>
              <member>
                <name>Object</name>
                <object>
                  <name>DoseTest.InjectableEntity</name>
                  <members>
                    <member>
                      <name>Info</name>
                      <value>Blabla</value>
                    </member>
                  </members>
                </object>
              </member>
              <member>
                <name>Handler</name>
                <value>DEFAULT_HANDLER</value>
              </member>
              <member>
                <name>Consumer</name>
                <value>0</value>
              </member>
            </members>
          </object>
        </arrayElement>
       <arrayElement>
          <object>
            <name>DoseTest.Action</name>
            <members>
              <member>
                <name>Partner</name>
                <value>1</value>
              </member>
              <member>
                <name>ActionKind</name>
                <value>DoseTest.ActionEnum.SetAll</value>
              </member>
              <member>
                <name>Instance</name>
                <value>222</value>
              </member>
              <member>
                <name>Object</name>
                <object>
                  <name>DoseTest.InjectableEntity</name>
                  <members>
                    <member>
                      <name>Info</name>
                      <value>qwerty</value>
                    </member>
                  </members>
                </object>
              </member>
              <member>
                <name>Handler</name>
                <value>DEFAULT_HANDLER</value>
              </member>
              <member>
                <name>Consumer</name>
                <value>0</value>
              </member>
            </members>
          </object>
        </arrayElement>
        <arrayElement>
          <object>
            <name>DoseTest.Action</name>
            <members>
              <member>
                <name>Partner</name>
                <value>1</value>
              </member>
              <member>
                <name>ActionKind</name>
                <value>DoseTest.ActionEnum.UnregisterHandler</value>
              </member>
              <member>
                <name>TypeId</name>
                <value>DoseTest.InjectableEntity</value>
              </member>
              <member>
                <name>Handler</name>
                <value>DEFAULT_HANDLER</value>
              </member>
              <member>
                <name>Consumer</name>
                <value>0</value>
              </member>
            </members>
          </object>
        </arrayElement>

        <!-- Set up what Partner 0 should do when receiving OnInjectedNewEntity -->
        <!-- The first OnInjectedNew set the "other" entity -->
        <!-- The second OnInjectedNew reset the callback actions -->
        <arrayElement>
          <object>
            <name>DoseTest.Action</name>
            <members>
              <member>
                <name>Partner</name>
                <value>0</value>
              </member>
              <member>
                <name>ActionKind</name>
                <value>DoseTest.ActionEnum.SetAll</value>
              </member>
              <member>
                <name>ActionCallback</name>
                <value>Safir.Dob.CallbackId.OnInjectedNewEntity</value>
              </member>
              <member>
                <name>Instance</name>
                <value>222</value>
              </member>
              <member>
                <name>Object</name>
                <object>
                  <name>DoseTest.InjectableEntity</name>
                </object>
              </member>
              <member>
                <name>Handler</name>
                <value>DEFAULT_HANDLER</value>
              </member>              
              <member>
                <name>Consumer</name>
                <value>0</value>
              </member>
            </members>
          </object>
        </arrayElement>
        <arrayElement>
          <object>
            <name>DoseTest.Action</name>
            <members>
              <member>
                <name>Partner</name>
                <value>0</value>
              </member>
              <member>
                <name>ActionKind</name>
                <value>DoseTest.ActionEnum.ResetCallbackActions</value>
              </member>
              <member>
                <name>ActionCallback</name>
                <value>Safir.Dob.CallbackId.OnInjectedNewEntity</value>
              </member>              
              <member>
                <name>Consumer</name>
                <value>0</value>
              </member>
            </members>
          </object>
        </arrayElement>
        <arrayElement>
          <object>
            <name>DoseTest.Action</name>
            <members>
              <member>
                <name>Partner</name>
                <value>0</value>
              </member>
              <member>
                <name>ActionKind</name>
                <value>DoseTest.ActionEnum.RegisterEntityHandlerInjection</value>
              </member>
              <member>
                <name>TypeId</name>
                <value>DoseTest.InjectableEntity</value>
              </member>
              <member>
                <name>Handler</name>
                <value>DEFAULT_HANDLER</value>
              </member>
              <member>
                <name>InstanceIdPolicy</name>
                <value>Safir.Dob.InstanceIdPolicy.RequestorDecidesInstanceId</value>
              </member>
              <member>
                <name>Consumer</name>
                <value>0</value>
              </member>
            </members>
          </object>
        </arrayElement>
        <arrayElement>
          <object>
            <name>DoseTest.Action</name>
            <members>
              <member>
                <name>Partner</name>
                <value>0</value>
              </member>
              <member>
                <name>ActionKind</name>
                <value>DoseTest.ActionEnum.DeleteAllInstances</value>
              </member>
              <member>
                <name>TypeId</name>
                <value>DoseTest.InjectableEntity</value>
              </member>
              <member>
                <name>Handler</name>
                <value>DEFAULT_HANDLER</value>
              </member>
              <member>
                <name>Consumer</name>
                <value>0</value>
              </member>
            </members>
          </object>
        </arrayElement>
      </arrayElements>
    </member>
  </members>
</object>

