<?xml version="1.0" encoding="utf-8"?>
<object xmlns="urn:safir-dots-unit">
  <name>DoseTest.Items.TestCase</name>
  <members>
    <member>
      <name>Description</name>
      <value>Test that all references are dropped when closing the connection (consumers are garbage collected). The test will be a NOP for non GC languages.</value>
    </member>
    <member>
      <name>Expectation</name>
      <value>No log that indicates remaining consumers.</value>
    </member>
    <member>
      <name>TestCaseSetupActions</name>
      <arrayElements>
        <!-- Close the testconnection and open it again. The excplicit Open will make sure that we will get a connection with a stop handler   -->
        <arrayElement>
          <object>
            <name>DoseTest.Action</name>
            <members>
              <member>
                <name>Partner</name>
                <value>0</value>
              </member>
              <member>
                <name>ActionKind</name>
                <value>DoseTest.ActionEnum.Close</value>
              </member>
            </members>
          </object>
        </arrayElement>
        <arrayElement>
          <object>
            <name>DoseTest.Action</name>
            <members>
              <member>
                <name>Partner</name>
                <value>0</value>
              </member>
              <member>
                <name>ActionKind</name>
                <value>DoseTest.ActionEnum.Open</value>
              </member>
            </members>
          </object>
        </arrayElement>
        <arrayElement>
          <object>
            <name>DoseTest.Action</name>
            <members>
              <member>
                <name>Partner</name>
                <value>0</value>
              </member>
              <member>
                <name>ActionKind</name>
                <value>DoseTest.ActionEnum.RegisterServiceHandler</value>
              </member>
              <member>
                <name>TypeId</name>
                <value>DoseTest.GlobalService</value>
              </member>
              <member>
                <name>Handler</name>
                <value>HANDLER_0</value>
              </member>
              <member>
                <name>Consumer</name>
                <value>0</value>
              </member>
            </members>
          </object>
        </arrayElement>
        <arrayElement>
          <object>
            <name>DoseTest.Action</name>
            <members>
              <member>
                <name>Partner</name>
                <value>0</value>
              </member>
              <member>
                <name>ActionKind</name>
                <value>DoseTest.ActionEnum.RegisterEntityHandler</value>
              </member>
              <member>
                <name>TypeId</name>
                <value>DoseTest.GlobalEntity</value>
              </member>
              <member>
                <name>Handler</name>
                <value>DEFAULT_HANDLER</value>
              </member>
              <member>
                <name>InstanceIdPolicy</name>
                <value>Safir.Dob.InstanceIdPolicy.RequestorDecidesInstanceId</value>
              </member>
              <member>
                <name>Consumer</name>
                <value>0</value>
              </member>
            </members>
          </object>
        </arrayElement>
        <arrayElement>
          <object>
            <name>DoseTest.Action</name>
            <members>
              <member>
                <name>Partner</name>
                <value>0</value>
              </member>
              <member>
                <name>ActionKind</name>
                <value>DoseTest.ActionEnum.RegisterEntityHandlerInjection</value>
              </member>
              <member>
                <name>TypeId</name>
                <value>DoseTest.SynchronousVolatileEntity</value>
              </member>
              <member>
                <name>Handler</name>
                <value>HANDLER_0</value>
              </member>
              <member>
                <name>InstanceIdPolicy</name>
                <value>Safir.Dob.InstanceIdPolicy.RequestorDecidesInstanceId</value>
              </member>
              <member>
                <name>Consumer</name>
                <value>0</value>
              </member>
            </members>
          </object>
        </arrayElement>
        <arrayElement>
          <object>
            <name>DoseTest.Action</name>
            <members>
              <member>
                <name>Partner</name>
                <value>0</value>
              </member>
              <member>
                <name>ActionKind</name>
                <value>DoseTest.ActionEnum.SubscribeMessage</value>
              </member>
              <member>
                <name>TypeId</name>
                <value>DoseTest.GlobalMessage</value>
              </member>
              <member>
                <name>Channel</name>
                <value>DEFAULT_CHANNEL</value>
              </member>
              <member>
                <name>IncludeSubclasses</name>
                <value>true</value>
              </member>
              <member>
                <name>Consumer</name>
                <value>0</value>
              </member>
            </members>
          </object>
        </arrayElement>
        <arrayElement>
          <object>
            <name>DoseTest.Action</name>
            <members>
              <member>
                <name>Partner</name>
                <value>0</value>
              </member>
              <member>
                <name>ActionKind</name>
                <value>DoseTest.ActionEnum.SubscribeEntity</value>
              </member>
              <member>
                <name>EntityId</name>
                <entityId>
                  <name>DoseTest.GlobalEntity</name>
                  <instanceId>0</instanceId>
                </entityId>
              </member>
              <member>
                <name>IncludeUpdates</name>
                <value>true</value>
              </member>
              <member>
                <name>RestartSubscription</name>
                <value>false</value>
              </member>
              <member>
                <name>IncludeSubclasses</name>
                <value>false</value>
              </member>
              <member>
                <name>Consumer</name>
                <value>0</value>
              </member>
            </members>
          </object>
        </arrayElement>
        <arrayElement>
          <object>
            <name>DoseTest.Action</name>
            <members>
              <member>
                <name>Partner</name>
                <value>0</value>
              </member>
              <member>
                <name>ActionKind</name>
                <value>DoseTest.ActionEnum.SubscribeRegistration</value>
              </member>
              <member>
                <name>TypeId</name>
                <value>DoseTest.GlobalEntity</value>
              </member>
              <member>
                <name>Handler</name>
                <value>HANDLER_0</value>
              </member>
              <member>
                <name>IncludeSubclasses</name>
                <value>true</value>
              </member>
              <member>
                <name>RestartSubscription</name>
                <value>false</value>
              </member>
              <member>
                <name>Consumer</name>
                <value>0</value>
              </member>
            </members>
          </object>
        </arrayElement>
        <arrayElement>
          <object>
            <name>DoseTest.Action</name>
            <members>
              <member>
                <name>Partner</name>
                <value>0</value>
              </member>
              <member>
                <name>ActionKind</name>
                <value>DoseTest.ActionEnum.SubscribeRegistration</value>
              </member>
              <member>
                <name>TypeId</name>
                <value>DoseTest.GlobalService</value>
              </member>
              <member>
                <name>Handler</name>
                <value>HANDLER_0</value>
              </member>
              <member>
                <name>IncludeSubclasses</name>
                <value>true</value>
              </member>
              <member>
                <name>RestartSubscription</name>
                <value>false</value>
              </member>
              <member>
                <name>Consumer</name>
                <value>0</value>
              </member>
            </members>
          </object>
        </arrayElement>
      </arrayElements>
    </member>
    <member>
      <name>TestActions</name>
      <arrayElements>
        <arrayElement>
          <object>
            <name>DoseTest.Action</name>
            <members>
              <member>
                <name>Partner</name>
                <value>0</value>
              </member>
              <member>
                <name>ActionKind</name>
                <value>DoseTest.ActionEnum.CloseAndCheckReferences</value>
              </member>
            </members>
          </object>
        </arrayElement>
      </arrayElements>
    </member>
  </members>
</object>

