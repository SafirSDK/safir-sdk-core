<?xml version="1.0" encoding="utf-8"?>
<DoseTest.Items.TestCase>
  <Description xml:space="preserve">Test that timestamps are set correctly on sequence and dictionary members</Description>
  <Expectation>
    Partner 1 uses SetAll and SetChanges to update an injectable entity.
    Partner 0 and 2 gets updates that indicate changes appropriately.
    P0 has timestamp change info and P2 does not.
  </Expectation>
  <TestCaseSetupActions>
    <DoseTest.Action>
      <ActionKind>RegisterEntityHandlerInjection</ActionKind>
      <Partner>1</Partner>
      <Consumer>0</Consumer>
      <TypeId>DoseTest.InjectableEntity3</TypeId>
      <Handler>DEFAULT_HANDLER</Handler>
      <InstanceIdPolicy>RequestorDecidesInstanceId</InstanceIdPolicy>
    </DoseTest.Action>
    <DoseTest.Action>
      <ActionKind>InjectorSubscribeEntity</ActionKind>
      <Partner>0</Partner>
      <Consumer>0</Consumer>
      <TypeId>DoseTest.InjectableEntity3</TypeId>
      <IncludeUpdates>true</IncludeUpdates>
      <IncludeSubclasses>false</IncludeSubclasses>
      <RestartSubscription>false</RestartSubscription>
      <WantsGhostDelete>false</WantsGhostDelete>
      <WantsLastState>false</WantsLastState>
      <DoesntWantSourceIsPermanentStore>true</DoesntWantSourceIsPermanentStore>
      <WantsAllStateChanges>false</WantsAllStateChanges>
      <TimestampChangeInfo>true</TimestampChangeInfo>
    </DoseTest.Action>
    <DoseTest.Action>
      <ActionKind>InjectorSubscribeEntity</ActionKind>
      <Partner>2</Partner>
      <Consumer>0</Consumer>
      <TypeId>DoseTest.InjectableEntity3</TypeId>
      <IncludeUpdates>true</IncludeUpdates>
      <IncludeSubclasses>false</IncludeSubclasses>
      <RestartSubscription>false</RestartSubscription>
      <WantsGhostDelete>false</WantsGhostDelete>
      <WantsLastState>false</WantsLastState>
      <DoesntWantSourceIsPermanentStore>true</DoesntWantSourceIsPermanentStore>
      <WantsAllStateChanges>false</WantsAllStateChanges>
      <TimestampChangeInfo>false</TimestampChangeInfo>
    </DoseTest.Action>
  </TestCaseSetupActions>
  <TestActions>
    <DoseTest.Action>
      <ActionKind>SetAll</ActionKind>
      <Partner>1</Partner>
      <Consumer>0</Consumer>
      <Instance>565656</Instance>
      <Handler>DEFAULT_HANDLER</Handler>
      <Object type="DoseTest.InjectableEntity3">
        <Int32SequenceMember><Int32>32</Int32><Int32>-32</Int32></Int32SequenceMember>
        <Int32Int32DictionaryMember>
          <entry><key>-32</key><value>-32000</value></entry>
          <entry><key>32</key><value>32000</value></entry>
        </Int32Int32DictionaryMember>
        <Int32ItemDictionaryMember>
          <entry><key>-32</key><DoseTest.TestItem><MyInt>3200</MyInt></DoseTest.TestItem></entry>
          <entry><key>32</key><DoseTest.TestItem><MyInt>-3200</MyInt></DoseTest.TestItem></entry>
        </Int32ItemDictionaryMember>
      </Object>
    </DoseTest.Action>
    <DoseTest.Action>
      <ActionKind>Sleep</ActionKind>
      <SleepDuration>0.5</SleepDuration>
    </DoseTest.Action>
    <DoseTest.Action>
      <ActionKind>SetChanges</ActionKind>
      <Partner>1</Partner>
      <Consumer>0</Consumer>
      <Instance>565656</Instance>
      <Handler>DEFAULT_HANDLER</Handler>
      <Object type="DoseTest.InjectableEntity3">
        <Int32SequenceMember><Int32>32</Int32></Int32SequenceMember>
        <Int32Int32DictionaryMember>
          <entry><key>-32</key><value>-32000</value></entry>
        </Int32Int32DictionaryMember>
        <Int32ItemDictionaryMember>
          <entry><key>-32</key><DoseTest.TestItem><MyInt>3200</MyInt></DoseTest.TestItem></entry>
        </Int32ItemDictionaryMember>
      </Object>
    </DoseTest.Action>
    <DoseTest.Action>
      <ActionKind>Sleep</ActionKind>
      <SleepDuration>0.5</SleepDuration>
    </DoseTest.Action>
    <DoseTest.Action>
      <ActionKind>SetChanges</ActionKind>
      <Partner>1</Partner>
      <Consumer>0</Consumer>
      <Instance>565656</Instance>
      <Handler>DEFAULT_HANDLER</Handler>
      <Object type="DoseTest.InjectableEntity3">
        <Int32ItemDictionaryMember>
          <entry><key>-32</key><DoseTest.TestItem><MyInt>32</MyInt></DoseTest.TestItem></entry>
        </Int32ItemDictionaryMember>
      </Object>
    </DoseTest.Action>
    <DoseTest.Action>
      <ActionKind>Sleep</ActionKind>
      <SleepDuration>0.5</SleepDuration>
    </DoseTest.Action>
    <DoseTest.Action>
      <ActionKind>SetChanges</ActionKind>
      <Partner>1</Partner>
      <Consumer>0</Consumer>
      <Instance>565656</Instance>
      <Handler>DEFAULT_HANDLER</Handler>
      <Object type="DoseTest.InjectableEntity3">
        <Int32SequenceMember/>
        <Int32Int32DictionaryMember/>
        <Int32ItemDictionaryMember/>
      </Object>
    </DoseTest.Action>
    <DoseTest.Action>
      <ActionKind>Sleep</ActionKind>
      <SleepDuration>0.5</SleepDuration>
    </DoseTest.Action>
    <DoseTest.Action>
      <ActionKind>Delete</ActionKind>
      <Partner>1</Partner>
      <Consumer>0</Consumer>
      <Handler>DEFAULT_HANDLER</Handler>
      <EntityId>
        <name>DoseTest.InjectableEntity3</name>
        <instanceId>565656</instanceId>
      </EntityId>
    </DoseTest.Action>
  </TestActions>
</DoseTest.Items.TestCase>
